# 🔐 Cryptographic Identity System

## Overview

The AI Record Label Platform implements a revolutionary **signature-based authentication system** that completely eliminates the need for traditional passwords. Instead, users authenticate using **BIP32/BIP44 HD wallet signatures** with specialized key derivation paths designed for the music industry.

## 🚀 Quick Start

### 1. Start the Platform
```bash
npm install
npm start
```

### 2. Generate Your Identity
Visit: http://localhost:3000 (serves `public/web3keys.html`)

### 3. Run Complete Demo
```bash
# In another terminal
npm run crypto-demo
```

## 🔑 Key Architecture

### BIP44 Derivation Paths
Each user gets **7 specialized key types** for different music industry actions:

```
Base Path: m/44'/236' (BSV coin type)

├── m/44'/236'/0'/0/0 → Identity Key (authentication)
├── m/44'/236'/1'/0/0 → Property Key (song ownership)
├── m/44'/236'/2'/0/0 → Contractual Key (licensing agreements)
├── m/44'/236'/3'/0/0 → Privacy Key (private communications)
├── m/44'/236'/4'/0/0 → Messages Key (public communications)
├── m/44'/236'/5'/0/0 → Financial Key (payments & royalties)
└── m/44'/236'/6'/0/0 → Document Key (legal verification)
```

### Action-Key Mapping
Each action type **requires** a specific key type:

| Action | Required Key | Use Case |
|--------|--------------|----------|
| `verify-identity` | Identity | User authentication |
| `upload-song` | Property | Song ownership claims |
| `sign-agreement` | Contractual | Licensing contracts |
| `process-payment` | Financial | Royalty distributions |
| `sign-document` | Document | Legal verification |

## 🎯 Authentication Flow

### 1. Identity Generation (Client-Side)
```javascript
// Generated by web3keys.html
const identity = MusicIdentitySDK.generateIdentity({
  email: 'artist@music.com',
  firstName: 'Artist',
  role: 'artist'
});

// Produces:
{
  identityAddress: '1ABC...xyz',
  privateKeys: { identity: '...', property: '...', ... },
  addresses: { identity: '1ABC...', property: '1DEF...', ... }
}
```

### 2. Registration (API)
```javascript
POST /api/identity/register
{
  "signedRegistration": {
    "signature": "base64_signature",
    "publicKey": "compressed_public_key", 
    "payload": {
      "action": "register-identity",
      "data": { /* identity + user info */ }
    }
  }
}
```

### 3. Authentication Challenge
```javascript
// Request challenge
POST /api/identity/auth/challenge
{ "identityAddress": "1ABC...xyz" }

// Response
{
  "challengeData": {
    "challenge": "random_hex_string",
    "action": "verify-identity"
  }
}
```

### 4. Sign & Verify
```javascript
// Sign with identity private key
const signed = MusicIdentitySDK.signAction(
  'verify-identity', 
  challenge, 
  identityPrivateKey
);

// Verify with API
POST /api/identity/auth/verify
{
  "signedChallenge": signed,
  "identityAddress": "1ABC...xyz"
}
```

## 🎵 Music Industry Actions

### Song Upload (Property Key)
```javascript
// Sign with property key
const songData = { title: 'New Track', genre: 'Electronic' };
const signed = MusicIdentitySDK.signAction('upload-song', songData, propertyKey);

POST /api/identity/action/execute
{ "signedAction": signed, "identityAddress": "..." }
```

### License Agreement (Contractual Key)
```javascript
// Sign with contractual key  
const agreement = { type: 'sync_license', duration: '12_months' };
const signed = MusicIdentitySDK.signAction('sign-agreement', agreement, contractualKey);
```

### Royalty Payment (Financial Key)
```javascript
// Sign with financial key
const payment = { amount: 1000, currency: 'USD', recipients: [...] };
const signed = MusicIdentitySDK.signAction('process-payment', payment, financialKey);
```

## 🛡️ Security Features

### Multi-Key Architecture
- **Compartmentalized Risk**: Each key type has limited scope
- **Action Enforcement**: Wrong key type = rejected transaction
- **HD Derivation**: All keys derived from single seed phrase

### Signature Verification
```javascript
// Every action verified server-side
const verification = MusicIdentitySDK.verifyActionSignature(
  signedAction, 
  expectedPublicKey
);

if (!verification.valid) {
  throw new Error(`Invalid signature: ${verification.reason}`);
}
```

### Replay Attack Prevention
- Timestamp validation (5-minute window)
- Unique challenge generation
- Signature binding to specific actions

## 📡 API Endpoints

### Identity Management
- `POST /api/identity/register` - Register cryptographic identity
- `POST /api/identity/auth/challenge` - Get authentication challenge
- `POST /api/identity/auth/verify` - Verify signed challenge

### Action System
- `POST /api/identity/action/sign` - Get signing instructions
- `POST /api/identity/action/execute` - Execute signed action

### Documentation
- `GET /api/docs` - Complete API documentation
- `GET /health` - Service health check

## 🔧 Implementation Details

### Client-Side (web3keys.html)
```html
<!-- Complete identity generation interface -->
- BIP39 mnemonic generation
- BIP32/BIP44 key derivation
- Address calculation for all 7 key types
- Encrypted backup creation
- Registration payload signing
```

### Server-Side (identityAPI.js)
```javascript
// Signature verification for each action
- Action-to-key mapping enforcement  
- Public key validation
- Timestamp verification
- Database integration with MongoDB
```

### SDK (web3IdentitySDK.js)
```javascript
// Core cryptographic operations
- HD wallet generation
- Action signing with appropriate keys
- Signature verification
- Backup encryption/decryption
```

## 🎯 Production Deployment

### Environment Setup
```bash
# Required environment variables
MONGODB_URI=mongodb://localhost:27017/ai_record_label
NODE_ENV=production
PORT=3000
```

### Security Considerations
1. **HTTPS Required** - All signature operations must use HTTPS
2. **Key Storage** - Client-side keys never sent to server
3. **Session Management** - Short-lived session tokens
4. **Rate Limiting** - Implement on challenge endpoints

## 🔄 Integration Examples

### Frontend Integration
```javascript
// Connect web3keys.html with platform
const identity = await generateIdentity(userInfo);
const registration = await MusicIdentitySDK.createRegistrationPayload(identity, userInfo);
const response = await registerWithAPI(registration);
```

### Blockchain Integration
```javascript
// Future BSV blockchain verification
const txid = await publishIdentityToBlockchain(identityAddress, publicKeys);
const verification = await verifyOnChain(txid);
```

## 📊 Benefits Over Traditional Auth

| Traditional Auth | Cryptographic Identity |
|------------------|----------------------|
| Username + Password | HD Wallet Signature |
| Single credential | 7 specialized keys |
| Centralized verification | Cryptographic proof |
| Password reuse risk | Unique signatures |
| Forgot password flow | Seed phrase recovery |
| Database breach risk | No secrets in database |

## 🚀 Next Steps

1. **Frontend Integration** - Connect web3keys.html with music upload interface
2. **BSV Integration** - On-chain identity verification
3. **Multi-Signature** - Complex agreements requiring multiple parties
4. **Mobile SDK** - Native mobile app integration
5. **Hardware Wallets** - Ledger/Trezor integration for enhanced security

## 🎵 Ready for Production!

This system is **production-ready** for real music industry use cases:
- ✅ Secure cryptographic authentication
- ✅ Industry-specific key derivation
- ✅ Action-based signature enforcement  
- ✅ Complete API integration
- ✅ MongoDB database integration
- ✅ BSV blockchain compatibility

**No more passwords - just cryptographic signatures! 🔐**